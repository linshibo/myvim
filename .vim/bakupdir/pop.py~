#!/usr/bin/python
# -*- coding: utf-8 -*-
import proto_base 
import struct
import mypub
class  Clogin_proto(proto_base .Cproto_base):
	def login(self,userid,passwd,regflag=0):
		self.set_userid(userid);
		primsg=struct.pack("<32sLLL16s6s", mypub.get_md5( mypub.get_md5( passwd)),regflag,12,0," "*16," "*6 );
		sendbuf=self.pack_with_buf(103,primsg);
		mypub.print_hex_16(sendbuf); 
		self.getsock().send(sendbuf)
		pass

	def get_online_list(self,startid,endid):
		#得到 online 列表
		primsg=struct.pack("<LLL",startid,endid,0 );
		sendbuf=self.pack_with_buf(106,primsg);
		self.getsock().send(sendbuf)
		pass

	def get_recommeded_list(self,key):
		#得到 online 列表
		primsg=struct.pack("<32s",key);
		sendbuf=self.pack_with_buf(105,primsg);
		self.getsock().send(sendbuf)
		pass


p=Clogin_proto("114.80.173.58", 1863)
p.setblocking(1)
p.get_online_list(1,50);
out_msg=p.getrecvmsg();
msg=out_msg[5][4:]
online_count=len(msg)/30

import struct
for i in range(online_count):
	line=msg[i*30:i*30+30]
	count,=struct.unpack("<L",line[4:8]  );
	print count
