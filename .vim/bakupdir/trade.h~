/*
 * =========================================================================
 *
 *        Filename: trade.h
 *
 *        Version:  1.0
 *        Created:  2012-02-16 08:45:10
 *        Description:  
 *
 *        Author:  francisco (francisco@taomee.com)
 *        Company:  TAOMEE
 *
 * =========================================================================
 */
#ifndef  TRADE_H
#define  TRADE_H
#include    "onlinehome.h"
#include <libtaomee++/proto/proto_base.h>
#include  <set>
#include  <map>
#include  <list>

typedef struct item_info{
	uint32_t itemid;
	uint32_t gettime;
	uint8_t  itemtype;
	uint32_t itemcnt;
	uint32_t price;
}item_info_t;

typedef struct player{
	uint32_t userid;
	uint32_t xiaomee;
}player_t;
enum{
	init_state=0,
};
class Cshop {
	private:
		uint32_t shopid;
		uint8_t  state;
		std::multimap<uint32_t,item_info_t> items;
	public:
		Cshop():shopid(0),state(init_state){

		}
		~Cshop();

};

class Croom {
	private:
		Cshop shops[8];
		mapid_t mapid;
		std::map<uint32_t,player_t> users;
	public:
		Croom(mapid_t m):mapid(m){

		}
		~Croom();
};
#define     TRADE_MAPID  40000
#define    	INIT_ROOM_CNT	300 
class Cmarket {
	private:
		std::map<mapid_t,Croom> rooms;
		uint32_t rooms_cnt;
	public:
		Cmarket():rooms_cnt(INIT_ROOM_CNT){
			for( uint32_t loop=0 ; loop<INIT_ROOM_CNT ; loop++ ){
				Croom tmp(((0xFC000000+loop)<<32) | TARDE_MAPID);
				rooms.insert(std::make_pair((((0xFC000000+loop)<<32) | TARDE_MAPID),tmp));				
			}
		}
		~Cmarket();

};

#endif  /*TRADE_H*/


