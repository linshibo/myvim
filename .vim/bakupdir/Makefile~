#DEBUG	= -g -DDEBUG
OPT	= -g3 -funroll-loops -D__USE_STRING_INLINES
#OPT += -DENABLE_TRACE_LOG
OPT	+= -DEPOLL_MODE -DUSE_SYSTEMV_SEM 
#OPT += -DSVRBENCH_OUTPUT_PKG_NEED_NOT_FREE
#OPT	+= -DEPOLL_MODE
OPT	+= -DWORK_POLL_MODE

CC	= g++
BINS	= ServerBench
SRCS 	= BufPool.cpp Filter.cpp QueueEvent.cpp Reactor.cpp ShmQueue.cpp \
		  TcpAccept.cpp UdpSocket.cpp TcpSocket.cpp TcpSocketPool.cpp Lock.cpp \
          Plugin.cpp main.cpp Util.cpp \

CFLAGS	= -I./ -Wall -MMD $(DEBUG) -D_REENTRANT -D_GNU_SOURCE $(OPT) -z defs 
LIBS	+= -ldl -rdynamic  -lpthread -ltaomee 

#all: $(BINS)
#	-sudo cp benchapi.h /usr/local/include/serverbench

%.o: %.cpp Makefile
	$(CC) $(CFLAGS) -c -o $@ $<
	@-mv -f $*.d .dep.$@
$(BINS): $(SRCS:.cpp=.o)
	$(CC)  $(LDFLAGS) -o $@ $^ $(LIBS)

clean:
	@-rm -f *.o *.po *.so *.d .dep.* $(BINS) core

-include /dev/null $(wildcard .dep.*)
