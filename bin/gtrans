#!/bin/bash
 
if [ "$#" -lt "3" ]; then
	echo 'usage translate ftom_lang to_lang word'
	echo 'Ex: gtrans en zh-cn hehe'
	exit
fi
 
#headers
#这堆http的请求头还是有必要添加的，不然给你返回些意想不到的结果出来
UserAgent="Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.81 Safari/537.1"
Referer="http://translate.google.com/"
AcceptEncoding="gzip,deflate"
AcceptCharset="UTF-8,*;q=0.5"
Accept="text/html,*/*;q=0.1"
 
#query
#这里把空格替换掉，这段代码写的貌似不是很优雅～～
key=$3
for arg in `seq 4 $#`
do
	key=$key"%20"$(eval echo "\$$arg")
#	str=$str$($arg)
done
 
echo "Querying: "`echo $key|sed -e 's/%20/ /g;p'`
 
#这里获取网页并把结果解压
url="http://translate.google.com/?sl=$1&tl=$2&text=$key" 
content=`curl -s \
	-H "User-Agent:$UserAgent"\
	-H "Referer:$Referer"\
	-H "Accept-Encoding:$AcceptEncoding"\
	-H "Accept-Charset:$AcceptCharset"\
	-H "Accept:$Accept"\
	"$url"\
	|gunzip`
 content1=`curl -s \
	-H "User-Agent:$UserAgent"\
	-H "Referer:$Referer"\
	-H "Accept-Encoding:$AcceptEncoding"\
	-H "Accept-Charset:$AcceptCharset"\
	-H "Accept:$Accept"\
	"$url"\
	|gunzip`
#用sed把我要的东西过滤出来
charset=`echo $content|sed -e 's/.*<meta.*charset=\([^";]*\)[";].*/\1/g'`
result_box=`echo $content|sed -e 's/.*<span.*id=result_box[^>]*>[^<]*<span[^>]*>\([^<]*\)<.*/\1/g'`
echo 'Result: '$result_box
